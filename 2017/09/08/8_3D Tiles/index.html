<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>3D Tiles翻译 | mindsight</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">3D Tiles翻译</h1><a id="logo" href="/.">mindsight</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">3D Tiles翻译</h1><div class="post-meta">Sep 8, 2017</div><div class="post-content"><h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>在3d tiles中，tileset是以空间数据结构（tree，树）组织的tile的集合。tile以包围体来完全封装它的内容。树（tree）具有空间一致性；子tile的内容完全在父包围体中。考虑到灵活性，树是具有空间一致性的任何空间数据结构，包括K-d树，四叉树，八叉树以及网格。</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/tree.png" alt=""></p>
<p>为了支持从规律划分的地形、不与经线或纬线对齐的城市以及任意点云等多样性数据集具有紧凑的体积，包围体可以是定向的包围盒(box)，包围球体(sphere)或者是以最小和最大经度、纬度、高程定义的地理区域(region）。</p>
<p>TODO：每种包围体类型的截图。</p>
<p>tile引用了一个或多个特征，比如，以3D模型表示的建筑或树木，点云中的点，矢量数据集中的多边形、多边线以及点。这些特征可批处理成简单的特征，从根本上减少客户端加载时间和WebGL绘制调用的开销。</p>
<h1 id="Tile-metadata"><a href="#Tile-metadata" class="headerlink" title="Tile metadata"></a>Tile metadata</h1><p>tile元数据-非实际内容，以JSON 定义，如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"boundingVolume"</span>: &#123;</div><div class="line">    <span class="string">"region"</span>: [</div><div class="line">      -1.2419052957251926,</div><div class="line">      0.7395016240301894,</div><div class="line">      -1.2415404171917719,</div><div class="line">      0.7396563300150859,</div><div class="line">      0,</div><div class="line">      20.4</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"geometricError"</span>: 43.88464075650763,</div><div class="line">  <span class="string">"refine"</span> : <span class="string">"ADD"</span>,</div><div class="line">  <span class="string">"content"</span>: &#123;</div><div class="line">    <span class="string">"boundingVolume"</span>: &#123;</div><div class="line">      <span class="string">"region"</span>: [</div><div class="line">        -1.2418882438584018,</div><div class="line">        0.7395016240301894,</div><div class="line">        -1.2415422846940714,</div><div class="line">        0.7396461198389616,</div><div class="line">        0,</div><div class="line">        19.4</div><div class="line">      ]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"url"</span>: <span class="string">"2/0/0.b3dm"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"children"</span>: [...]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>属性boundingVolume.region是一个长度为6的数组，以WGS84/EPSG:4326坐标系定义地理区域边界，顺序依次为[west, south, east, north, minimum height, maximum height]。经度和纬度以弧度表示，高程以在WGS84椭球平面以上或以下的米数表示。除了region， 也用能用到其他包围体，比如box和sphere。</p>
<p>属性geometricError是一个非负数，单位为米，它定义了由于父瓦片渲染、子瓦片不渲染而引入的误差。在运行时，几何误差用于计算屏幕空间误差（Screen-Space Error ，SSE），比如，像素测量误差。SSE决定了层次细节（Hierarchical Level of Detail ，HLOD）的细化，比如，如果tile在当前视野下已充分细化，那么它的子瓦片应该考虑进来。</p>
<p>属性viewerRequestVolume是可选的（上面JSON没有展示出来），它定义了一个与boundingVolume相同模式的包围体，viewer 必须在tile的内容被请求、瓦片基于geometricError细化前，， 条件是观察者必须在viewerRequestVolume之内。参见Viewer request volume段落。</p>
<p>属性refine是字符串，要么是ADD，要么是REPLACE，ADD表示添加操作， REPLACE表示替换操作。tile集合的根tile必选，其他tile是可选的。当refine被省略，集成父tile的属性。</p>
<p>属性content是一个对象，它包含关于tile的内容和链接的元数据，属性content.url以绝对路径或相对路径指向tile的内容。上面的例子中，2/0/0.b3dm 是TMS分片模式，{z}/{y}/{x}.extension， 但这不是必须的，参见roadmap Q&amp;A.</p>
<p>在tileset.json文件中，url用来创建tileset。参见External tilesets.</p>
<p>content.url的文件扩展名不是必需的。内容的tile格式可以在magic属性中确定，或作为外部tileset，如果内容是json。</p>
<p>content.boundingVolume 定义了可选的包围体，类似顶层的boundingVolume属性。但是与顶层的包围体属性不同的是content.boundingVolume是紧密的bounding volume封闭的是tile的内容。它用于替换操作。boundingVolume提供空间一致性，content.boundingVolume enables tight view frustum culling.下图展示了CanaryWharf的根tile，红色表示boundingVolume包围了tileset的整个区域，蓝色表示content.boundingVolume包含了根tile的4个特征（模型）。</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/contentsBox.png" alt=""></p>
<p>Content是可选的。当content未被定义，tile的bounding volume仍然用于剔除。</p>
<p>属性transform是可选的，它定义了4x4仿射变换矩阵，仿射变换将Tile的content, boundingVolume,和viewerRequestVolume转换为Tile transform 章节描述的那样。</p>
<p>属性children是对象数组，它定义了子tiles。如下图所示</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/tile.png" alt=""> </p>
<h2 id="Coordinate-System-and-Units"><a href="#Coordinate-System-and-Units" class="headerlink" title="Coordinate System and Units"></a>Coordinate System and Units</h2><p>3D Tiles 使用right-handed Cartesian坐标系统，即，x、y、z的矢量积。3D Tiles定义了z轴来弥补平面笛卡尔坐标系统。Tileset的全局坐标系统通常是WGS84坐标系统，但是不是必须的，比如发电厂模型使用没有空间信息的建模工具、采用局部坐标系统来充分描述。<br>b3dm 和 i3dm tiles 嵌入 glTF。glTF采用right-handed坐标系统，y轴在上。默认情况下，嵌入模型被认为是Y轴向上的，但是为了支持各种元数据，包括直接以WGS84坐标系定义的模型，嵌入的 glTF模型可以使用tile.json文件中的asset.gltfUpAxis 属性定义x轴向上，y轴向上, 或 z轴向上。一般来说，在运行时，将glTF资源转为z轴向上，从而与bounding volume分层的z轴向上的坐标系统一致。<br>所有直线距离的单位是米。<br>所有角度单位是弧度。<br>3D Tiles不显示地存储制图坐标（经度、纬度、高程）。这些值是隐性的，在WGS84坐标系，由于不需要非仿射坐标变换，GPU可以高效地渲染。3D Tiles的tileset可以包含具体<br>的元数据，比如制图坐标，但是这种语义不是3D Tiles的一部分。</p>
<h2 id="Tile-transform"><a href="#Tile-transform" class="headerlink" title="Tile transform"></a>Tile transform</h2><p>为支持局部坐标系统，比如，建筑tileset在城市tileset中，它有自己的坐标系统，点云tileset在建筑中，它也有自己的坐标系统，每个tile都具有可选的transform属性。<br>属性transform是4x4 仿射变换矩阵，以column-major order顺序存储，从Tile的局部坐标系转换为父Tile的坐标系统，或根tileset的坐标系统。<br>Transform属性使用于：<br>（1）    tile.content<br>a)    每个特侦的位置<br>b)    每个特征的法线<br>（2）    tile.boundingVolume<br>（3）    tile.viewerRequestVolume,</p>
<p>属性transform不适用于geometricError，比如，transform定义的比例不是几何误差的比例。<br>当transform未被定义，默认是单位矩阵：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">1.0, 0.0, 0.0, 0.0,</div><div class="line">0.0, 1.0, 0.0, 0.0,</div><div class="line">0.0, 0.0, 1.0, 0.0,</div><div class="line">0.0, 0.0, 0.0, 1.0</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>从每个tile的局部坐标系统转为tileset的全局坐标系统，自顶向下遍历tileset然后乘以子tile的转换矩阵，像计算机图形学中的传统场景图，或分层节点。<br>下面的JavaScript代码，展示了如何计算使用Cesium’s Matrix4 和 Matrix3 类型。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">function</span> computeTransforms(tileset) &#123;</div><div class="line">    var t = tileset.root;</div><div class="line">    var transformToRoot = defined(t.transform) ? Matrix4.fromArray(t.transform) : Matrix4.IDENTITY;</div><div class="line">    computeTransform(t, transformToRoot);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">function</span> computeTransform(tile, transformToRoot) &#123;</div><div class="line">    // Apply 4x4 transformToRoot to this tile<span class="string">'s positions and bounding volumes</span></div><div class="line"><span class="string"></span></div><div class="line"><span class="string">    var inverseTransform = Matrix4.inverse(transformToRoot, new Matrix4());</span></div><div class="line"><span class="string">    var normalTransform = Matrix4.getRotation(inverseTransform, new Matrix3());</span></div><div class="line"><span class="string">    normalTransform = Matrix3.transpose(normalTransform, normalTransform);</span></div><div class="line"><span class="string">    // Apply 3x3 normalTransform to this tile'</span>s normals</div><div class="line"></div><div class="line">    var children = tile.children;</div><div class="line">    var length = children.length;</div><div class="line">    <span class="keyword">for</span> (var k = 0; k &lt; length; ++k) &#123;</div><div class="line">        var child = children[k];</div><div class="line">        var childToRoot = defined(child.transform) ? Matrix4.fromArray(child.transform) : Matrix4.clone(Matrix4.IDENTITY);</div><div class="line">        childToRoot = Matrix4.multiplyTransformation(transformToRoot, childToRoot, childToRoot);</div><div class="line">        computeTransform(child, childToRoot);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>举一个计算tileset变换的例子（上面代码中transformToRoot），考虑：</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/tileTransform.png" alt=""></p>
<p>tile变换计算如下：<br>•    T0: [T0]<br>•    T1: [T0][T1]<br>•    T2: [T0][T2]<br>•    T3: [T0][T1][T3]<br>•    T4: [T0][T1][T4]<br>在tile变换前（在仿射变换后乘前），tile的content属性中的位置和法线也有tile-specific类似变换 。例如：<br>•    b3dm和i3dm瓦片嵌入glTF，它们定义了自己的节点层次，每个节点具有一个变换，这些变换在tile的变换前处理<br>•    i3dm的特征表定义了实例的位置，法线，和缩放。他们用于创建4x4仿射变换矩阵实例，该矩阵在tile.transform前应用于每个实例。<br>•    属性压缩，比如，i3dm特征表中POSITION_QUANTIZED， pnts，vctr，pnts中的OCT16P，应该在其他任何变换解压缩。<br>因此，以上例子全计算变换如下<br>•    T0: [T0]<br>•    T1: [T0][T1]<br>•    T2: [T0][T2][pnts-specific Feature Table properties-derived transform]<br>•    T3: [T0][T1][T3][b3dm-specific transform, including the glTF node hierarchy]<br>•    T4: [T0][T1][T4][i3dm-specific transform, including per-instance Feature Table properties-derived transform and the glTF node hierarchy]</p>
<h2 id="viewer-request-volume"><a href="#viewer-request-volume" class="headerlink" title="viewer request volume"></a>viewer request volume</h2><p>瓦片的viewerRequestVolume可以用于结合异构数据集，并可以与外部瓦片集结合。下面的例子包含了一份b3dm瓦片的建筑数据，以及建筑里面的pnts瓦片的的点云数据。点云瓦片的boundingVolume是半径为1.25的sphere。该点云瓦片还有一个更大的、半径为15的sphere类型的viewerRequestVolume。由于geometricError是0，当viewer在由viewerRequestVolume定义的大sphere中，点云瓦片的content才被初始请求和渲染。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="string">"children"</span>: [&#123;</div><div class="line">  <span class="string">"transform"</span>: [</div><div class="line">     4.843178171884396,   1.2424271388626869, 0,                  0,</div><div class="line">    -0.7993325488216595,  3.1159251367235608, 3.8278032889280675, 0,</div><div class="line">     0.9511533376784163, -3.7077466670407433, 3.2168186118075526, 0,</div><div class="line">     1215001.7612985559, -4736269.697480114,  4081650.708604793,  1</div><div class="line">  ],</div><div class="line">  <span class="string">"boundingVolume"</span>: &#123;</div><div class="line">    <span class="string">"box"</span>: [</div><div class="line">      0,     0,    6.701,</div><div class="line">      3.738, 0,    0,</div><div class="line">      0,     3.72, 0,</div><div class="line">      0,     0,    13.402</div><div class="line">    ]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"geometricError"</span>: 32,</div><div class="line">  <span class="string">"content"</span>: &#123;</div><div class="line">    <span class="string">"url"</span>: <span class="string">"building.b3dm"</span></div><div class="line">  &#125;</div><div class="line">&#125;, &#123;</div><div class="line">  <span class="string">"transform"</span>: [</div><div class="line">     0.968635634376879,    0.24848542777253732, 0,                  0,</div><div class="line">    -0.15986650990768783,  0.6231850279035362,  0.7655606573007809, 0,</div><div class="line">     0.19023066741520941, -0.7415493329385225,  0.6433637229384295, 0,</div><div class="line">     1215002.0371330238,  -4736270.772726648,   4081651.6414821907, 1</div><div class="line">  ],</div><div class="line">  <span class="string">"viewerRequestVolume"</span>: &#123;</div><div class="line">    <span class="string">"sphere"</span>: [0, 0, 0, 15]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"boundingVolume"</span>: &#123;</div><div class="line">    <span class="string">"sphere"</span>: [0, 0, 0, 1.25]</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"geometricError"</span>: 0,</div><div class="line">  <span class="string">"content"</span>: &#123;</div><div class="line">    <span class="string">"url"</span>: <span class="string">"points.pnts"</span></div><div class="line">  &#125;</div><div class="line">&#125;]</div></pre></td></tr></table></figure>
<p>TODO: screenshot showing the request vs. bounding volume<br>关于request volumes想了解更多, 请 参见e sample tileset 和 demo video。</p>
<h1 id="tileset-json"><a href="#tileset-json" class="headerlink" title="tileset.json"></a>tileset.json</h1><p>tileset.json 定义了瓦片集. 下面是tileset.json的子集， 用于 Canary Wharf (tileset.json):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="string">"asset"</span> : &#123;</div><div class="line">    <span class="string">"version"</span>: <span class="string">"0.0"</span>,</div><div class="line">    <span class="string">"tilesetVersion"</span>: <span class="string">"e575c6f1-a45b-420a-b172-6449fa6e0a59"</span>,</div><div class="line">    <span class="string">"gltfUpAxis"</span>: <span class="string">"Y"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="string">"properties"</span>: &#123;</div><div class="line">    <span class="string">"Height"</span>: &#123;</div><div class="line">      <span class="string">"minimum"</span>: 1,</div><div class="line">      <span class="string">"maximum"</span>: 241.6</div><div class="line">    &#125;</div><div class="line">  &#125;,</div><div class="line">  <span class="string">"geometricError"</span>: 494.50961650991815,</div><div class="line">  <span class="string">"root"</span>: &#123;</div><div class="line">    <span class="string">"boundingVolume"</span>: &#123;</div><div class="line">      <span class="string">"region"</span>: [</div><div class="line">        -0.0005682966577418737,</div><div class="line">        0.8987233516605286,</div><div class="line">        0.00011646582098558159,</div><div class="line">        0.8990603398325034,</div><div class="line">        0,</div><div class="line">        241.6</div><div class="line">      ]</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"geometricError"</span>: 268.37878244706053,</div><div class="line">    <span class="string">"content"</span>: &#123;</div><div class="line">      <span class="string">"url"</span>: <span class="string">"0/0/0.b3dm"</span>,</div><div class="line">      <span class="string">"boundingVolume"</span>: &#123;</div><div class="line">        <span class="string">"region"</span>: [</div><div class="line">          -0.0004001690908972599,</div><div class="line">          0.8988700116775743,</div><div class="line">          0.00010096729722787196,</div><div class="line">          0.8989625664878067,</div><div class="line">          0,</div><div class="line">          241.6</div><div class="line">        ]</div><div class="line">      &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="string">"children"</span>: [..]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>tileset.json顶级对象具有4个属性：asset，properties，geometricError, 以及root。<br>Asset对象包含描述整个瓦片集的元数据的属性。Version属性定义了3D Tiles的版本。版本定义了tileset.json的JOSN概要、瓦片格式的基础集合 。tilesetVersion属性可选，它定义了瓦片集的应用版本，比如，当已经存在的瓦片集需要更新时使用。gltfUpAxis属性可选，它瓦片集中glTF模型的up-axis。<br>Properties属性是包含对象的对象，for瓦片集中每个per-feature属性。本tileset.json片段描述了3D建筑，因此每个瓦片包含了建筑模型，每个建筑模型包含了高度属性(参见 Batch Table)。属性中每个对象的名字与per-feature属性的名字匹配，定义了最小、最大的数值，这些值非常有用，举个例子，比如为样式创建颜色斜面。<br>geometricError定义了瓦片集不被渲染的几何误差，非负数，单位为米。<br>Root属性是对象，它使用上面章节描述的JSON定义了根瓦片。root.geometricError和tileset.json顶级geometricError不一样。tileset.json顶层geometricError是tileset不被渲染时的geometricError，root.geometricError是root tile渲染时的误差。<br>root.children 是对象数组，定义了子瓦片。每个子瓦片的boundingVolume被父瓦片的 boundingVolume完全包含，通常，它们的geometricError小于父瓦片的geometricError。对于叶子瓦片，数组的长度为0，那么children未被定义。<br>参见 schema 了解完整的tileset.json.<br>参见 Q&amp;A below 了解 tileset.json 如何规模地描述大量的瓦片。<br>External tilesets<br>创建树的一个节点，瓦片的content.url可以指向外部的瓦片集（另外的tileset.json）。<br>这样可以将每个城市存在各自的瓦片集中，然后用各城市的瓦片集来组成去求的瓦片集。</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/tilesets.jpg" alt=""></p>
<p>When a tile points to an external tileset, the tile<br>当瓦片指向外部的瓦片集，瓦片<br>•    Cannot have any children, tile.children must be undefined or an empty array.<br>•    不能拥有任何子瓦片，tile.children必须未定义或是空数组<br>•    具有各种属性，匹配外部瓦片集的根瓦片：<br>o    root.geometricError === tile.geometricError,<br>o    root.refine === tile.refine, and<br>o    root.boundingVolume === tile.content.boundingVolume (or root.boundingVolume === tile.boundingVolume when tile.content.boundingVolume is undefined).<br>o    root.viewerRequestVolume === tile.viewerRequestVolume or root.viewerRequestVolume is undefined.<br>•    Cannot be used to create cycles, for example, by pointing to the same tileset.json containing the tile or by pointing to another tileset.json that then points back to the tileset.json containing the tile. tileset.json<br>•    不能用于创建循环，例如，指向包含瓦片的相同的tileset.json，或指向另外的tileset.json这个json又指向回来<br>o    瓦片的变换和根瓦片的变换均被应用。例如，下面引用外部瓦片的瓦片，T3的计算变换是[T0][T1][T2][T3]。</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/tileTransformExternalTileset.png" alt=""></p>
<h2 id="Bounding-volume-spatial-coherence"><a href="#Bounding-volume-spatial-coherence" class="headerlink" title="Bounding volume spatial coherence"></a>Bounding volume spatial coherence</h2><p>正如以上所述，树具有空间一致性;每个瓦片具有一个包围体完全封闭它的内容，子瓦片的内容完全在父包围体中。这并不意味着子瓦片的包围体完全在父瓦片的包围体中。例如：</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/parentBoundingSphere.jpg" alt="地形瓦片的包围球体"></p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/childBoundingSphere.jpg" alt="四个子瓦片的包围球体。子瓦片的内容完全在父瓦片的包围体中，但是子瓦片的包围体不完全在父瓦片的包围体中，因为它们不是紧包围的"></p>
<h2 id="Creating-spatial-data-structures"><a href="#Creating-spatial-data-structures" class="headerlink" title="Creating spatial data structures"></a>Creating spatial data structures</h2><p>在tileset.json中通过root定义了树，递归，树的子节点可以定义空间数据结构的不同类型。此外，可以采用任意瓦片格式和细化方法replacement or additive)的组合，允许很大的灵活性来在支持各种各样的数据集。<br>    这取决于生成tileset.json转换工具，来定义数据集最优的树。运行引擎，比如Cesium，是通用的，并能渲染tileset.json定义的树。这里对3D Tiles如何表示各种空间结构进行简要说明。</p>
<h3 id="K-d-trees"><a href="#K-d-trees" class="headerlink" title="K-d trees"></a>K-d trees</h3><p>当瓦片存在两个子瓦片 当与x, y, 或 z 轴平行的分裂面将瓦片分割成两个子瓦片时，k-d 树被创建。随着树的层级的增加，分裂轴通常循环旋转，分裂平面可以采用中位数分裂，表面积探索、或其他的方式。</p>
<p>![非均匀细分的K-d树]<a href="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/kdtree.png" target="_blank" rel="external">https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/kdtree.png</a></p>
<p>注意k-d树不具备典型的2D地理空间瓦片体系的均匀细分特点，因此，k-d树可以为稀疏和不均匀分布的数据集创建更多的平衡树。<br>3D Tiles允许使用k-d 树的变种，比如多路k-d树，可以使树的每个叶子节点沿轴线有多个分裂。每个瓦片不是只有两个子瓦片，而是有n个子瓦片。</p>
<h3 id="Quadtrees"><a href="#Quadtrees" class="headerlink" title="Quadtrees"></a>Quadtrees</h3><p>当每个瓦片具有4个均匀细分的子瓦片（比如，使用中心经纬度），可以创建四叉树，类似典型的二维地理空间瓦片体系。空瓦片可以删除。</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/quadtree.png" alt="典型的四叉树细分"></p>
<p>3D Tiles允许四叉数变化，比如非均匀细分和紧包围（和包围相反，例如，父瓦片的25%，对于稀疏数据集是浪费的）。</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/quadtree-tight.png" alt="紧包围盒包围瓦片的四叉树"></p>
<p>举个例子，下面是Canary Wharf的根瓦片和子瓦片。注意底左区域，这个地方的的包围体不包括左面没有建筑的的水域，如下：</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/looseQuadtree.png" alt=""></p>
<h3 id="Octrees"><a href="#Octrees" class="headerlink" title="Octrees"></a>Octrees</h3><p>八叉树继承了四叉树，采用3个正交分裂平面将一个瓦片再细分成8个子瓦片。类似四叉树，3D Tiles允许采用八叉树的变种，例如非均匀细分，紧包围体，以及重叠子瓦片。</p>
<p><img src="https://github.com/AnalyticalGraphicsInc/3d-tiles/blob/master/figures/octree.png" alt="典型的八叉树细分"></p>
<p>以下是精细化点云的非均匀八叉树细分。该点云在the Church of St Marie at Chappes, France ，来自Prof. Peter Allen, Columbia University Robotics Lab。由Alejandro Troccoli 和 Matei Ciocarlie扫描。</p>
<h3 id="Grids"><a href="#Grids" class="headerlink" title="Grids"></a>Grids</h3><p>3D Tiles通过支持任意数量的子瓦片来实现统一的、不统一的以及重叠的网格。举个例子，以下是剑桥的不统一重叠的网格的俯视图。</p>
<p><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/grid.png" alt=""></p>
<p>3D Tiles利用了空瓦片的优势：这些瓦片具有bounding volume，但是没有content。由于瓦片的content属性不需要定义，空的非叶子瓦片可以使用分层剔除加速非统一网格。这对创建没有分层LOD的四叉树或八叉树非常必要。</p>
<h1 id="Tile-formats"><a href="#Tile-formats" class="headerlink" title="Tile formats"></a>Tile formats</h1><p>每个瓦片的content.url属性指向另外一个瓦片，该瓦片的格式在上面Status section列出。<br>瓦片集可以包含任何瓦片格式的组合。3D Tiles也支持在同一瓦片中采用Composite瓦片。<br>Declarative styling<br><img src="https://raw.githubusercontent.com/AnalyticalGraphicsInc/3d-tiles/master/figures/style.jpg" alt="使用声明式样式以高度着色的建筑物"></p>
<p>3D Tiles include concise declarative styling defined with JSON and expressions written in a small subset of JavaScript augmented for styling.<br>Styles generally define a feature’s show and color (RGB and translucency) using an expression based on a feature’s properties, for example:<br>{<br>    “color” : “(${Temperature} &gt; 90) ? color(‘red’) : color(‘white’)”<br>}<br>This colors features with a temperature above 90 as red and the others as white.<br>完整细节请参见 Declarative Styling spec.</p>
<h1 id="Roadmap-Q-amp-A"><a href="#Roadmap-Q-amp-A" class="headerlink" title="Roadmap Q&amp;A"></a>Roadmap Q&amp;A</h1><p>•    General Q&amp;A<br>o    Can I use 3D Tiles today?<br>o    Are 3D Tiles specific to Cesium?<br>o    What is the relationship between 3D Tiles and glTF?<br>o    Do 3D Tiles support runtime editing?<br>o    Will 3D Tiles include terrain?<br>o    Will 3D Tiles include imagery?<br>o    Will 3D Tiles replace KML?<br>•    Technical Q&amp;A<br>o    How do 3D Tiles support heterogeneous datasets?<br>o    Will tileset.json be part of the final 3D Tiles spec?<br>o    How do I request the tiles for Level n?<br>o    Will 3D Tiles support horizon culling?<br>o    Is screen-space error the only metric used to drive refinement?<br>o    How are cracks between tiles with vector data handled?<br>o    When using replacement refinement, can multiple children be combined into one request?<br>o    How can additive refinement be optimized?<br>o    What compressed texture formats do 3D Tiles use?</p>
<h1 id="General-Q-amp-A"><a href="#General-Q-amp-A" class="headerlink" title="General Q&amp;A"></a>General Q&amp;A</h1><h2 id="Can-I-use-3D-Tiles-today"><a href="#Can-I-use-3D-Tiles-today" class="headerlink" title="Can I use 3D Tiles today?"></a>Can I use 3D Tiles today?</h2><p>We expect the initial 3D Tiles spec to evolve until fall 2016. If you are OK with things changing, then yes, jump in.</p>
<h2 id="Are-3D-Tiles-specific-to-Cesium"><a href="#Are-3D-Tiles-specific-to-Cesium" class="headerlink" title="Are 3D Tiles specific to Cesium?"></a>Are 3D Tiles specific to Cesium?</h2><p>No, 3D Tiles are a general spec for streaming massive heterogeneous 3D geospatial datasets. The Cesium team started this initiative because we need an open format optimized for streaming 3D content to Cesium. AGI, the founder of Cesium, is also developing tools for creating 3D Tiles. We expect to see other visualization engines and conversion tools use 3D Tiles.</p>
<h2 id="What-is-the-relationship-between-3D-Tiles-and-glTF"><a href="#What-is-the-relationship-between-3D-Tiles-and-glTF" class="headerlink" title="What is the relationship between 3D Tiles and glTF?"></a>What is the relationship between 3D Tiles and glTF?</h2><p>glTF, the runtime asset format for WebGL, is an open standard for 3D models from Khronos (the same group that does WebGL and COLLADA). Cesium uses glTF as its 3D model format, and the Cesium team contributes heavily to the glTF spec and open-source COLLADA2GLTF converter. We recommend using glTF in Cesium for individual assets, e.g., an aircraft, a character, or a 3D building.</p>
<h2 id="We-created-3D-Tiles-for-streaming-massive-geospatial-datasets-where-a-single-glTF-model-would-be-prohibitive-Given-that-glTF-is-optimized-for-rendering-that-Cesium-has-a-well-tested-glTF-loader-and-that-there-are-existing-conversion-tools-for-glTF-3D-Tiles-use-glTF-for-some-tile-formats-such-as-b3dm-used-for-3D-buildings-We-created-a-binary-glTF-extension-KHR-binary-glTF-in-order-to-embed-glTF-into-binary-tiles-and-avoid-base64-encoding-or-multiple-file-overhead"><a href="#We-created-3D-Tiles-for-streaming-massive-geospatial-datasets-where-a-single-glTF-model-would-be-prohibitive-Given-that-glTF-is-optimized-for-rendering-that-Cesium-has-a-well-tested-glTF-loader-and-that-there-are-existing-conversion-tools-for-glTF-3D-Tiles-use-glTF-for-some-tile-formats-such-as-b3dm-used-for-3D-buildings-We-created-a-binary-glTF-extension-KHR-binary-glTF-in-order-to-embed-glTF-into-binary-tiles-and-avoid-base64-encoding-or-multiple-file-overhead" class="headerlink" title="We created 3D Tiles for streaming massive geospatial datasets where a single glTF model would be prohibitive. Given that glTF is optimized for rendering, that Cesium has a well-tested glTF loader, and that there are existing conversion tools for glTF, 3D Tiles use glTF for some tile formats such as b3dm (used for 3D buildings). We created a binary glTF extension (KHR_binary_glTF) in order to embed glTF into binary tiles and avoid base64-encoding or multiple file overhead."></a>We created 3D Tiles for streaming massive geospatial datasets where a single glTF model would be prohibitive. Given that glTF is optimized for rendering, that Cesium has a well-tested glTF loader, and that there are existing conversion tools for glTF, 3D Tiles use glTF for some tile formats such as b3dm (used for 3D buildings). We created a binary glTF extension (KHR_binary_glTF) in order to embed glTF into binary tiles and avoid base64-encoding or multiple file overhead.</h2><p>Taking this approach allows us to improve Cesium, glTF, and 3D Tiles at the same time, e.g., when we add mesh compression to glTF, it benefits 3D models in Cesium, the glTF ecosystem, and 3D Tiles.</p>
<h2 id="Does-3D-Tiles-support-runtime-editing"><a href="#Does-3D-Tiles-support-runtime-editing" class="headerlink" title="Does 3D Tiles support runtime editing?"></a>Does 3D Tiles support runtime editing?</h2><p>A common use case for 3D buildings is to stream a city dataset, color each building based on one or more properties (e.g., the building’s height), and then hide a few buildings and replace them with high-resolution 3D buildings. With 3D Tiles, this type of editing can be done at runtime.<br>The general case runtime editing of geometry on a building, vector data, etc., and then efficiently saving those changes in a 3D Tile will be possible, but is not the initial focus. However, styling is much easier since it can be applied at runtime without modification to the 3D Tiles tree and is part of the initial work.<br>Will 3D Tiles include terrain?<br>Yes, a quantized-mesh-like tile would fit well with 3D Tiles and allow Cesium to use the same streaming code (we say quantized-mesh-like because some of the metadata, e.g., for bounding volumes and horizon culling, may be organized differently or moved to tileset.json).<br>However, since Cesium already streams terrain well, we are not focused on this in the short-term.<br>Will 3D Tiles include imagery?<br>Yes, there is an opportunity to provide an optimized base layer of terrain and imagery (similar to how a 3D model contains both geometry and textures). There is also the open research problem of how to tile imagery for 3D. In 2D, only one LOD (z layer) is used for a given view. In 3D, especially when looking towards the horizon, tiles from multiple LODs are adjacent to each other. How do we make the seams look good? This will likely require tool and runtime support.<br>As with terrain, since Cesium already streams imagery well, we are not focused on this in the short-term.<br>Will 3D Tiles replace KML?<br>In many cases, yes. KML regions and network links are a clunky approach to streaming massive 3D geospatial datasets on the web. 3D Tiles are built for the web and optimized for streaming; true HLOD is used; polygons do not need to be triangulated; and so on.</p>
<h1 id="Technical-Q-amp-A"><a href="#Technical-Q-amp-A" class="headerlink" title="Technical Q&amp;A"></a>Technical Q&amp;A</h1><p>How do 3D Tiles support heterogeneous datasets?<br>Geospatial datasets are heterogeneous: 3D buildings are different from terrain, which is different from point clouds, which are different from vector data, and so on.<br>3D Tiles support heterogeneous data by allowing different tile formats in a tileset, e.g., a tileset may contain tiles for 3D buildings, tiles for instanced 3D trees, and tiles for point clouds, all using different tile formats.<br>3D Tiles also support heterogeneous datasets by concatenating different tile formats into one tile using the Composite tile format. In the example above, a tile may have a short header followed by the content for the 3D buildings, instanced 3D trees, and point clouds.<br>Supporting heterogeneous datasets with both inter-tile (different tile formats in the same tileset) and intra-tile (different tile formats in the same Composite tile) options allows conversion tools to make trade-offs between number of requests, optimal type-specific subdivision, and how visible/hidden layers are streamed.<br>Will tileset.json be part of the final 3D Tiles spec?<br>Yes. There will always be a need to know metadata about the tileset and about tiles that are not yet loaded, e.g., so only visible tiles can be requested. However, when scaling to millions of tiles, a single tileset.json with metadata for the entire tree would be prohibitively large.<br>3D Tiles already support trees of trees. content.url can point to another tileset.json, which enables conversion tools to chunk up a tileset into any number of tileset.json files that reference each other.<br>There’s a few other ways we may solve this:<br>•    Moving subtree metadata to the tile payload instead of tileset.json. Each tile would have a header with, for example, the bounding volumes of each child, and perhaps grandchildren, and so on.<br>•    Explicit tile layout like those of traditional tiling schemes (e.g., TMS’s z/y/x). The challenge is that this implicitly assumes a spatial subdivision, whereas 3D Tiles are general enough to support quadtrees, octrees, k-d trees, and so on. There is likely to be a balance where two or three explicit tiling schemes can cover common cases to complement the generic spatial data structures.<br>How do I request the tiles for Level n?<br>More generally, how do 3D Tiles support the use case for when the viewer is zoomed in very close to terrain, for example, and we do not want to load all the parent tiles toward the root of the tree; instead, we want to skip right to the high-resolution tiles needed for the current 3D view?<br>This 3D Tiles topic needs additional research, but the answer is basically the same as above: either the skeleton of the tree can be quickly traversed to find the desired tiles or an explicit layout scheme will be used for specific subdivisions.<br>Will 3D Tiles support horizon culling?<br>Since horizon culling is useful for terrain, 3D Tiles will likely support the metadata needed for it. We haven’t considered it yet since our initial work with 3D Tiles is for 3D buildings where horizon culling is not effective.<br>Is Screen-Space Error the only metric used to drive refinement?<br>At runtime, a tile’s geometricError is used to compute the Screen-Space Error (SSE) to drive refinement. We expect to expand this, for example, by using the Virtual Multiresolution Screen Space Error (VMSSE), which takes occlusion into account. This can be done at runtime without streaming additional tile metadata. Similarly, fog can also be used to tolerate increases to the SSE in the distance.<br>However, we do anticipate other metadata for driving refinement. SSE may not be appropriate for all datasets; for example, points of interest may be better served with on/off distances and a label collision factor computed at runtime. Note that the viewer’s height above the ground is rarely a good metric for 3D since 3D supports arbitrary views.<br>See #15.<br>How are cracks between tiles with vector data handled?<br>Unlike 2D, in 3D, we expect adjacent tiles to be from different LODs so, for example, in the distance, lower resolution tiles are used. Adjacent tiles from different LODs can lead to an artifact called cracking where there are gaps between tiles. For terrain, this is generally handled by dropping skirts slightly angled outward around each tile to fill the gap. For 3D buildings, this is handled by extending the tile boundary to fully include buildings on the edge; see above. For vector data, this is an open research problem that we need to solve. This could invole boundary-aware simplification or runtime stitching.<br>When using replacement refinement, can multiple children be combined into one request?<br>Often when using replacement refinement, a tile’s children are not rendered until all children are downloaded (an exception, for example, is unstructured data such as point clouds, where clipping planes can be used to mask out parts of the parent tile where the children are loaded; naively using the same approach for terrain or an arbitrary 3D model results in cracking or other artifacts between the parent and child).<br>We may design 3D Tiles to support downloading all children in a single request by allowing tileset.json to point to a subset of a file for a tile’s content similiar to glTF buffer and bufferView. HTTP/2 will also make the overhead of multiple requests less important.<br>See #9.<br>How can additive refinement be optimized?<br>Compared to replacement refinement, additive refinement has a size advantage because it doesn’t duplicate data in the original dataset. However, it has a disadvantage when there are expensive tiles to render near the root and the view is zoomed in close. In this case, for example, the entire root tile may be rendered, but perhaps only one feature or even no features are visible.<br>3D Tiles can optimize this by storing an optional spatial data structure in each tile. For example, a tile could contain a simple 2x2 grid, and if the tile’s bounding volume is not completely inside the view frustum, each box in the grid is checked against the frustum, and only those inside or intersecting are rendered.<br>See #11.<br>What compressed texture formats do 3D Tiles use?<br>3D Tiles will support the same texture compression that glTF will support. In addition, we need to consider how well GPU formats compress compared to, for example, jpeg. Some desktop game engines stream jpeg, then decompress and recompress to a GPU format in a thread. The CPU overhead for this approach may be too high for JavaScript and Web Workers.<br>Acknowledgments<br>•    Erik Andersson<br>•    Sarah Chow<br>•    Kevin Ring<br>•    Dylan Brown<br>•    Leesa Fini<br>Data credits<br>The screenshots in this spec use awesome CyberCity3D buildings and the Bing Maps base layer.</p>
</div><div class="tags"></div><div class="post-nav"><a href="/2017/09/02/7_osg_osgearth_func/" class="next">OSG/osgEarth相关功能函数</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="windydreams.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/8_3D Tiles/">3D Tiles翻译</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/7_osg_osgearth_func/">OSG/osgEarth相关功能函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/31/6_dae2gltf/">dae转glTF</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/23/5_3D_GIS_BASIC/">3D基础概念集合</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/3_mongodb_linux_install/">Mongodb Linux 安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/4_elasticsearch_linux_install/">Elasticsearch Linux 安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/2_gis_concept/">地图服务的一些基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/16/1_geoserver/">GeoServer Eclipse开发环境搭建</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">mindsight.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>