<!DOCTYPE html><html lang="null"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>OSG/osgEarth相关功能函数 | mindsight</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OSG/osgEarth相关功能函数</h1><a id="logo" href="/.">mindsight</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">OSG/osgEarth相关功能函数</h1><div class="post-meta">Sep 2, 2017</div><div class="post-content"><h3 id="1、字符串转double、float"><a href="#1、字符串转double、float" class="headerlink" title="1、字符串转double、float"></a>1、字符串转double、float</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">double osg::asciiToFloat(const char* str);</div><div class="line"></div><div class="line">double osg::asciiToDouble(const char* str);</div></pre></td></tr></table></figure>
<p>位于\src\osg\Math.cpp</p>
<h3 id="2、快速生成Geometry、Geode"><a href="#2、快速生成Geometry、Geode" class="headerlink" title="2、快速生成Geometry、Geode"></a>2、快速生成Geometry、Geode</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">Geode* osg::createGeodeForImage(osg::Image* image);</div></pre></td></tr></table></figure>
<p>位于\src\osg\image.cpp</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Geometry* osg::createTexturedQuadGeometry(const Vec3&amp; corner, const Vec3&amp; widthVec,</div><div class="line">	const Vec3&amp; heightVec, <span class="built_in">float</span> s = 1.0f, <span class="built_in">float</span> t = 1.0f);</div></pre></td></tr></table></figure>
<p>位于\src\osg\Geometry</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">osg::Geode* geode = new osg::Geode();</div><div class="line"></div><div class="line">osg::ShapeDrawable* drawable = new osg::ShapeDrawable(new osg::Box(osg::Vec3(1,1,1), 1));</div><div class="line"></div><div class="line">geode-&gt;addDrawable(drawable);</div><div class="line"></div><div class="line">_root-&gt;addChild(geode);</div></pre></td></tr></table></figure>
<h3 id="3、检测一个路径是否是网络路径"><a href="#3、检测一个路径是否是网络路径" class="headerlink" title="3、检测一个路径是否是网络路径"></a>3、检测一个路径是否是网络路径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bool osgDB::containsServerAddress( const std::string&amp; filename);</div></pre></td></tr></table></figure>
<p>位于\src\osgDB\FileNameUtils.cpp</p>
<p>相关函数：获取网络协议和网络地址：getServerProtocol()和getServerAddress()</p>
<h3 id="4、文件、文件夹操作"><a href="#4、文件、文件夹操作" class="headerlink" title="4、文件、文件夹操作"></a>4、文件、文件夹操作</h3><p>所在目录 osgDB\FileUtils.h</p>
<p>a、 新建目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">extern bool makeDirectory(const std::string &amp;directiryPath);</div></pre></td></tr></table></figure></p>
<p>b、判断一个文件路径是否存在<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">extern bool fileExists(const std::string &amp;fileName);</div></pre></td></tr></table></figure></p>
<p>c、获取一个目录下的文件列表<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div><div class="line">typedef std::vector&lt;std::string&gt; DirectoryContents;</div><div class="line"></div><div class="line">extern DirectoryContents getDirectoryContents(const std::string &amp;dirName);</div></pre></td></tr></table></figure></p>
<p>d、判断一个filename是文件还是目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">enum FileType&#123;　FILE_NOT_FOUND, REGULAR_FILE, DIRECTORY&#125;;</div><div class="line"></div><div class="line">extern FileType fileType(const std::string&amp; filename);</div></pre></td></tr></table></figure></p>
<p>e、读取XML文档，osgEarth/XmlUtils<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">osgEarth::XmlDocument* doc = new osgEarth::XmlDocument::load(const std::string&amp; xmlfile);</div><div class="line"></div><div class="line">osgEarth::Config docConfig = doc-&gt;getConfig();</div><div class="line"></div><div class="line"><span class="keyword">if</span>(!config.empty())</div><div class="line">&#123;</div><div class="line"></div><div class="line">	std::string name=config.value(<span class="string">"name"</span>);</div><div class="line"></div><div class="line">	int age=config.value&lt;int&gt;(<span class="string">"age"</span>,0);</div><div class="line"></div><div class="line">	// 需要注意的是key字符串必须都是小写，例如源XML中为MySet标签，</div><div class="line">	// 只能写config.find(<span class="string">"myset"</span>);不能写config.find(<span class="string">"MySet"</span>);</div><div class="line"></div><div class="line">	osgEarth::Config* mySet=config.find(<span class="string">"myset"</span>);</div><div class="line"></div><div class="line">	<span class="keyword">if</span>(config.hasChild(<span class="string">"child1"</span>))</div><div class="line">	&#123;</div><div class="line">	  osgEarth::Config child=config.child(<span class="string">"child1"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="5、在地球上放置模型"><a href="#5、在地球上放置模型" class="headerlink" title="5、在地球上放置模型"></a>5、在地球上放置模型</h3><p>注意从osgEarth2.4版本开始，删除了osgEarth::Util::ObjectPlacer类。</p>
<p>对于2.3版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">osgEarth::Map* map = new osgEarth::Map();</div><div class="line"></div><div class="line">osgEarth::MapNode* mapNode = new osgEarth::MapNode(map);</div><div class="line"></div><div class="line">osgEarth::Util::ObjectPlacer* objPlacer = new osgEarth::Util::ObjectPlacer( mapNode );</div><div class="line"></div><div class="line">osg::Node* model = osgDB::readNodeFile(<span class="string">"teapot.3ds"</span>);</div><div class="line"></div><div class="line">//lat,lon表示模型在地球的纬度和经度,elevation是海拔</div><div class="line">osg::Node* modelOnEarth = objPlacer-&gt;placeNode( model, lat, lon, elevation );</div><div class="line"></div><div class="line">root-&gt;addChild( modelOnEarth );//添加到场景的根</div></pre></td></tr></table></figure>
<p>对于2.4版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">osgEarth::GeoPoint point(mapNode-&gt;getMapSRS(), lon, lat, elevation, </div><div class="line">	osgEarth::ALTMODE_ABSLOTE);</div><div class="line"></div><div class="line">osg::Matrix m;</div><div class="line"></div><div class="line">point.createLocalToWorld(m);</div><div class="line"></div><div class="line">osg::MatrixTransform* mt = new osg::MatrixTransform(m);</div><div class="line"></div><div class="line">mt-&gt;addChild(model);</div></pre></td></tr></table></figure>
<h3 id="6、获取地球半径"><a href="#6、获取地球半径" class="headerlink" title="6、获取地球半径"></a>6、获取地球半径</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">double equqtorRadius = map-&gt;getSRS()-&gt;getEllipsoid()-&gt;getRadiusEquator();//6378137.0赤道半径</div></pre></td></tr></table></figure>
<h3 id="7、设定Home视点"><a href="#7、设定Home视点" class="headerlink" title="7、设定Home视点"></a>7、设定Home视点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">osgEarth::Util::EarthManipulator* em = new osgEarth::Util::EarthManipulator();</div><div class="line"></div><div class="line">//正对北京地面，视点高度离地面高度为4个地球半径</div><div class="line">em-&gt;setHomeViewpoint( osgEarth::Util::Viewpoint(116,40,0,0,-90,equqtorRadius*4 ));</div><div class="line"></div><div class="line">viewer-&gt;setCameraManipulator(em);</div><div class="line"></div><div class="line">//设置初始视点</div><div class="line">em-&gt;setViewpoint(osgEarth::Util::Viewpoint(126,43,0,0,-90,5e4), 5);//5s,定位吉林</div></pre></td></tr></table></figure>
<h3 id="8、视点经过屏幕鼠标的射线与远、近裁剪面的交点"><a href="#8、视点经过屏幕鼠标的射线与远、近裁剪面的交点" class="headerlink" title="8、视点经过屏幕鼠标的射线与远、近裁剪面的交点"></a>8、视点经过屏幕鼠标的射线与远、近裁剪面的交点</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#include &lt;osgManipulator/Dragger&gt;</span></div><div class="line"></div><div class="line">osgManipulator::PointerInfo pi;</div><div class="line"></div><div class="line">pi.setCamera(camera);</div><div class="line"></div><div class="line">pi.setMousePosition(x,y);//x,y非归一化坐标，例如（10，30）</div><div class="line"></div><div class="line">osg::Vec3 nearPoint,farPoint;//射线和远近裁剪面的交点</div><div class="line"></div><div class="line">pi.getNearFarPoints(nearPoint,farPoint);</div></pre></td></tr></table></figure>
<h3 id="9、OSG三个坐标轴向量"><a href="#9、OSG三个坐标轴向量" class="headerlink" title="9、OSG三个坐标轴向量"></a>9、OSG三个坐标轴向量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// osg\Vec3f文件末尾，直接使用，例如osg::Vec3f v = osg::X_AXIS;</div><div class="line"></div><div class="line">const Vec3f X_AXIS(1.0,0.0,0.0);</div><div class="line"></div><div class="line">const Vec3f Y_AXIS(0.0,1.0,0.0);</div><div class="line"></div><div class="line">const Vec3f Z_AXIS(0.0,0.0,1.0);</div></pre></td></tr></table></figure>
<h3 id="10、反锯齿"><a href="#10、反锯齿" class="headerlink" title="10、反锯齿"></a>10、反锯齿</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">osg::DisplaySettings::instance()-&gt;setNumMultiSamples(4);</div></pre></td></tr></table></figure>
<h3 id="11、PageLOD最大节点数量-默认是300"><a href="#11、PageLOD最大节点数量-默认是300" class="headerlink" title="11、PageLOD最大节点数量(默认是300)"></a>11、PageLOD最大节点数量(默认是300)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">viewer-&gt;getDatabasePager()-&gt;setTargetMaximumNumbeOfPageLOD(100);</div></pre></td></tr></table></figure>
<h3 id="12、获取摄像机（视点）在世界坐标中的位置"><a href="#12、获取摄像机（视点）在世界坐标中的位置" class="headerlink" title="12、获取摄像机（视点）在世界坐标中的位置"></a>12、获取摄像机（视点）在世界坐标中的位置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">osg::Vec3 vPosEye, vCenter, vUp;</div><div class="line"></div><div class="line">camera-&gt;getViewMatrixAsLookAt( vPosEye, vCenter, vUp);</div></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">osg::ref_ptr&lt;osg::Camera&gt; cameraMaster = viewer-&gt;getCamera();         </div><div class="line"></div><div class="line">osg::Matrix _inverseMV;</div><div class="line"></div><div class="line">_inverseMV.invert( cameraMaster-&gt;getViewMatrix());</div><div class="line"></div><div class="line">osg::Vec3 ptEye= osg::Vec3(  0, 0, 0) * _inverseMV;</div><div class="line"></div><div class="line">/*	</div><div class="line">    获取世界坐标系下的视点坐标：</div><div class="line">	世界坐标系中某点Pworld在视点坐标系中为Pview，</div><div class="line">	则Pview= Pworld * MV。</div><div class="line">	则Pworld=Pview * MV逆，</div><div class="line">	则视点坐标系下的视点（0,0,0）在世界坐标系下为：ptEye=（0,0,0）* MV逆。</div><div class="line">*/</div></pre></td></tr></table></figure>
<h3 id="13、-x-y-z-lt-–-gt-lon-lat-elevation"><a href="#13、-x-y-z-lt-–-gt-lon-lat-elevation" class="headerlink" title="13、(x,y,z)&lt;–&gt;(lon, lat, elevation)"></a>13、(x,y,z)&lt;–&gt;(lon, lat, elevation)</h3><p>方法1：mapNode-&gt;getMapSRS()-&gt;getEllipsoid()-&gt;convertLatLongHeightToXYZ( osg::DegreesToRadians( lat ), osg::DegreesToRadians( lon), alt, x, y, z);</p>
<p>To Map coordinates</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">GeoPoint map;</div><div class="line"></div><div class="line">map.fromWorld( mapNode-&gt;getMapSRS(), x, y, z );//map.xyz is now lon, lat, alt</div></pre></td></tr></table></figure>
<p>To world coordinates</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">GeoPoint map( mapNode-&gt;getMapSRS(), lon, lat, alt, ALTMODE_ABSOLUTE);</div><div class="line"></div><div class="line">osg::Vec3d world;</div><div class="line"></div><div class="line">map.toWorld( world );</div></pre></td></tr></table></figure>
<h3 id="14、使用osgEarth-ModelLayer添加模型"><a href="#14、使用osgEarth-ModelLayer添加模型" class="headerlink" title="14、使用osgEarth::ModelLayer添加模型"></a>14、使用osgEarth::ModelLayer添加模型</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">osgEarth::Drivers::SimpleModelOptions opt;</div><div class="line"></div><div class="line">opt.url()=<span class="string">"c:/glider.osg"</span>;</div><div class="line"></div><div class="line">//lon和lat单位是度，elevation单位是米，例如(112, 36, 1000)</div><div class="line">opt.location()=osg::Vec3d(lon, lat, elevation);</div><div class="line"></div><div class="line">map-&gt;addModelLayer(new osgEarth::ModelLayer(<span class="string">"model"</span>, opt));</div></pre></td></tr></table></figure>
<h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://www.cnblogs.com/coolbear/archive/2013/05/20/3088595.html</div></pre></td></tr></table></figure>
</div><div class="tags"></div><div class="post-nav"><a href="/2017/09/08/8_3D Tiles/" class="pre">3D Tiles翻译</a><a href="/2017/08/31/6_dae2gltf/" class="next">dae转glTF</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="windydreams.github.io"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/8_3D Tiles/">3D Tiles翻译</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/02/7_osg_osgearth_func/">OSG/osgEarth相关功能函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/31/6_dae2gltf/">dae转glTF</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/23/5_3D_GIS_BASIC/">3D基础概念集合</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/3_mongodb_linux_install/">Mongodb Linux 安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/4_elasticsearch_linux_install/">Elasticsearch Linux 安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/17/2_gis_concept/">地图服务的一些基本概念</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/16/1_geoserver/">GeoServer Eclipse开发环境搭建</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">mindsight.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>